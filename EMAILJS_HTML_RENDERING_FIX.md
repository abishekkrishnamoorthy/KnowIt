# EmailJS HTML Rendering Fix

## Problem: HTML Showing as Plain Text

When HTML content appears as plain text in emails (e.g., `<p>text</p>` instead of formatted text), it means EmailJS is **escaping** the HTML for security reasons.

## Solution: Use Triple Braces for HTML Content

EmailJS uses different syntax for HTML vs plain text:
- `{{variable}}` - **Escapes HTML** (safe for user input, shows tags as text)
- `{{{variable}}}` - **Renders HTML** (for pre-formatted HTML content)

## Updated Template Variables

### Plain Text Variables (use `{{}}`)
These should use double braces because they contain plain text:
- `{{user_name}}` - User's name
- `{{email_type}}` - Email type
- `{{quiz_title}}` - Quiz title
- `{{main_message}}` - Main message
- `{{email_reason}}` - Email reason
- `{{app_url}}` - App URL

### HTML Content Variables (use `{{{}}}`)
These should use **triple braces** because they contain pre-formatted HTML:
- `{{{quiz_difficulty}}}` - Difficulty info (HTML formatted)
- `{{{expiration_date}}}` - Expiration date (HTML formatted)
- `{{{total_attempts}}}` - Total attempts (HTML formatted)
- `{{{leaderboard_html}}}` - Complete leaderboard section (HTML)
- `{{{expiration_notice_html}}}` - Expiration notice (HTML)
- `{{{stats_html}}}` - Stats grid (HTML)
- `{{{cta_html}}}` - Call-to-action button (HTML)

## How to Fix

### Step 1: Update EmailJS Template

1. Go to EmailJS Dashboard: https://dashboard.emailjs.com/
2. Navigate to **Email Templates**
3. Find your leaderboard template
4. Click **Edit**
5. Find these variables and change them:

**Change from:**
```html
{{quiz_difficulty}}
{{expiration_date}}
{{total_attempts}}
{{expiration_notice_html}}
{{leaderboard_html}}
{{stats_html}}
{{cta_html}}
```

**Change to:**
```html
{{{quiz_difficulty}}}
{{{expiration_date}}}
{{{total_attempts}}}
{{{expiration_notice_html}}}
{{{leaderboard_html}}}
{{{stats_html}}}
{{{cta_html}}}
```

6. **Keep plain text variables as double braces:**
```html
{{user_name}}
{{email_type}}
{{quiz_title}}
{{main_message}}
{{email_reason}}
{{app_url}}
```

7. Click **Save**

### Step 2: Verify Template

The template should now have:
- Double braces `{{}}` for plain text variables
- Triple braces `{{{}}}` for HTML content variables

### Step 3: Test

1. Test in browser console:
   ```javascript
   await window.testQuizCompletionEmail('your-email@example.com', 'Your Name')
   ```

2. Check your email - HTML should now render properly

## Why This Works

- **Double braces `{{}}`**: EmailJS escapes HTML to prevent XSS attacks
  - Input: `<p>Hello</p>`
  - Output: `&lt;p&gt;Hello&lt;/p&gt;` (shown as text)

- **Triple braces `{{{}}}`**: EmailJS renders HTML as-is
  - Input: `<p>Hello</p>`
  - Output: Formatted paragraph (rendered HTML)

Since our code sends **pre-formatted HTML strings**, we need triple braces to render them.

## Security Note

⚠️ **Only use triple braces for trusted HTML content!**

- ✅ Safe: HTML generated by your code (like `leaderboard_html`, `stats_html`)
- ❌ Unsafe: User-generated content (like `user_name`, `quiz_title`)

That's why we use:
- `{{user_name}}` - User input, needs escaping
- `{{{leaderboard_html}}}` - Code-generated HTML, safe to render

## Quick Reference

| Variable Type | Syntax | Example |
|--------------|--------|---------|
| Plain text | `{{variable}}` | `{{user_name}}` |
| HTML content | `{{{variable}}}` | `{{{leaderboard_html}}}` |

## Updated Template Section

The quiz info section should look like this:

```html
<div class="quiz-info">
  <h2>{{quiz_title}}</h2>
  {{{quiz_difficulty}}}
  {{{expiration_date}}}
  {{{total_attempts}}}
</div>

{{{expiration_notice_html}}}
{{{leaderboard_html}}}
{{{stats_html}}}
{{{cta_html}}}
```

## Troubleshooting

### Still seeing HTML as text?

1. **Check template in EmailJS:**
   - Make sure you saved the template
   - Verify triple braces are used: `{{{variable}}}`
   - Not double braces: `{{variable}}`

2. **Check variable names:**
   - Must match exactly (case-sensitive)
   - `{{{leaderboard_html}}}` not `{{{leaderboardHtml}}}`

3. **Clear cache:**
   - Delete and recreate the template
   - Or wait a few minutes for cache to clear

### HTML not rendering correctly?

- Check that the HTML sent by code is valid
- Look at browser console logs to see what HTML is being sent
- Verify CSS classes are in the template's `<style>` section

## Example: Before vs After

**Before (HTML escaped):**
```
<p><strong>Difficulty:</strong> easy</p>
```

**After (HTML rendered):**
```
Difficulty: easy
(Formatted as bold text)
```

